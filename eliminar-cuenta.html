<!doctype html>
<html lang="es-AR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eliminar cuenta | Tu Kiosquito</title>
  <style>
    body { font-family: system-ui, Arial; margin: 0; padding: 24px; }
    .wrap { max-width: 760px; margin: 0 auto; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    label { display: block; margin-top: 12px; font-weight: 600; }
    input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; }
    button { margin-top: 14px; padding: 10px 14px; border-radius: 10px; border: 0; cursor: pointer; }
    .danger { background: #c62828; color: white; }
    .muted { opacity: .85; font-size: .95rem; }
    .warn {
      margin: 14px 0;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #f0ad4e;
      background: #fff8e1;
      color: #5a4100;
    }
    .msg { margin-top: 12px; padding: 10px; border-radius: 10px; }
    .ok { background: #e8f5e9; border: 1px solid #a5d6a7; }
    .err { background: #ffebee; border: 1px solid #ef9a9a; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Eliminar cuenta – Tu Kiosquito</h1>
    <p class="muted">
      Ingresá el correo y contraseña de tu cuenta. Esta acción es irreversible.
    </p>

    <div class="warn">
      <strong>Importante:</strong> si tu cuenta tenía una <strong>suscripción activa</strong> o acceso a un <strong>plan pago</strong>,
      al eliminar la cuenta <strong>perderás el acceso</strong> asociado a esa cuenta.
      <br/>
      <span class="muted">
        (La cancelación de cobros depende del proveedor de pagos; si corresponde, gestioná la suscripción desde Google Play u otro medio.)
      </span>
    </div>

    <div class="card">
      <label for="email">Correo</label>
      <input id="email" type="email" autocomplete="email" placeholder="tuemail@ejemplo.com" />

      <label for="password">Contraseña</label>
      <input id="password" type="password" autocomplete="current-password" placeholder="********" />

      <button class="danger" id="btn">Eliminar mi cuenta</button>

      <div id="msg" class="msg" style="display:none;"></div>
    </div>
  </div>

  <script>
    // ⚠️ Cambiá esto por tu backend real (HTTPS)
    const API_BASE = "https://TU-DOMINIO-BACKEND.com";
    const ENDPOINT = `${API_BASE}/api/users/delete-account/`;

    const btn = document.getElementById("btn");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const msg = document.getElementById("msg");

    function showMessage(text, ok=true) {
      msg.style.display = "block";
      msg.className = "msg " + (ok ? "ok" : "err");
      msg.textContent = text;
    }

    btn.addEventListener("click", async () => {
      const e = (email.value || "").trim().toLowerCase();
      const p = password.value || "";

      if (!e || !p) {
        showMessage("Completá correo y contraseña.", false);
        return;
      }

      const confirm1 = confirm(
        "¿Seguro que querés eliminar tu cuenta? Esta acción es irreversible y perderás el acceso si tenías suscripción/plan pago."
      );
      if (!confirm1) return;

      btn.disabled = true;
      btn.textContent = "Eliminando...";

      try {
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: e, password: p })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          showMessage(data.detail || `Error (${res.status})`, false);
          return;
        }

        showMessage(
          data.detail || "Cuenta eliminada correctamente. Si tenías una suscripción activa, perderás el acceso asociado a esa cuenta.",
          true
        );
        password.value = "";
      } catch (err) {
        showMessage(
          "No se pudo conectar con el servidor. Revisá la URL del backend y la configuración de CORS/HTTPS.",
          false
        );
      } finally {
        btn.disabled = false;
        btn.textContent = "Eliminar mi cuenta";
      }
    });
  </script>
</body>
</html>
